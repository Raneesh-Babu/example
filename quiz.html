<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Multi-Language Quiz</title>
    <style>
        /* Global Styles */
        body {
            font-family: 'Poppins', Arial, sans-serif;
            background-color: #e0f7fa;
            color: #333;
            padding: 20px;
            box-sizing: border-box;
            margin: 0;
        }

        .container {
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s ease-in-out;
        }

        h2,
        h3 {
            color: #00796b;
        }

        button {
            background-color: #00796b;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 25px;
            margin: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #004d40;
        }

        select {
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 25px;
            border: 1px solid #00796b;
            outline: none;
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .timer {
            font-size: 20px;
            font-weight: bold;
            color: #d32f2f;
            margin-bottom: 20px;
        }

        .option {
            padding: 10px;
            margin: 10px auto;
            background-color: #e0f2f1;
            border-radius: 25px;
            border: 2px solid transparent;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: 0.3s ease;
        }

        .option:hover {
            background-color: #b2dfdb;
            border-color: #00796b;
        }

        .option.selected {
            background-color: #004d40;
            color: white;
            font-weight: bold;
        }

        /* Navigation Buttons */
        #prevBtn,
        #nextBtn,
        #submitBtn {
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            margin: 5px;
            border-radius: 25px;
        }

        #prevBtn {
            background-color: #00897b;
        }

        #nextBtn {
            background-color: #4db6ac;
        }

        #submitBtn {
            background-color: #d32f2f;
        }

        #submitBtn:hover {
            background-color: #b71c1c;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Language Selection -->
        <div id="language-selection">
            <h2>Select Language / भाषा चुनें</h2>
            <!button onclick="setLanguage('en')"></button>
                <button onclick="setLanguage('hi')">हिन्दी</button>
                <!button onclick="setLanguage('ml')"></button>
        </div>

        <!-- User Selection -->
        <div id="user-selection" class="hidden">
            <h2 id="selectUserTitle">Select Username</h2>
            <select id="usernameSelect"></select>
            <button onclick="startQuiz()">Start Quiz</button>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container" class="hidden">
            <h3 id="playerName"></h3>
            <p class="timer">Time Left: <span id="timeLeft"></span></p>
            <div id="question-container"></div>
            <button id="prevBtn" onclick="prevQuestion()">← Previous</button>
            <button id="nextBtn" onclick="nextQuestion()">Next →</button>
            <button id="submitBtn" class="hidden" onclick="submitQuiz()">Submit Quiz</button>
        </div>
    </div>

    <script>
        const API_KEY = "jXXkrUUqrQK3RlESaDPs2gq0Eu0SK4Sw";
        const USERS_TABLE_ID = "444317";
        const SCORES_TABLE_ID = "444864";
        const USERS_URL = `https://api.baserow.io/api/database/rows/table/${USERS_TABLE_ID}/`;
        const SCORES_URL = `https://api.baserow.io/api/database/rows/table/${SCORES_TABLE_ID}/`;

        let language = 'en';
        let userId, userName, userRealName, permit;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let score = 0;
        let timer, totalTime;
        let scoreUploaded = false;

        const questions = {
            en: [
                { question: "What is 2+2?", options: ["3", "4", "5", "6"], answer: "4" },
                { question: "Capital of India?", options: ["Mumbai", "Delhi", "Kolkata", "Chennai"], answer: "Delhi" }
            ],
            hi:[
  {
    question: "What is the meaning of the Hindi phrase 'आप कैसे हैं?'",
    options: ["Where are you?", "How are you?", "What do you do?", "Are you going?"],
    answer: "How are you?"
  },
  {
    question: "What is the Malayalam meaning of 'निमंत्रण'?",
    options: ["ക്ഷീണം", "ക്ഷണം", "ക്ഷമ", "ക്ഷുഭിതം"],
    answer: "ക്ഷണം"
  },
  {
    question: "What is the Hindi translation of 'Where is the washroom?'",
    options: ["वॉशरूम कहाँ है?", "आप वॉशरूम जा रहे हैं?", "वॉशरूम कैसा है?", "यह वॉशरूम है?"],
    answer: "वॉशरूम कहाँ है?"
  },
  {
    question: "What does the Hindi phrase 'जनरल कोच' mean?",
    options: ["പരിശീലകൻ", "പൊതുവായ കോച്ച്", "വൃത്തിയായ കോച്ച്", "അഡ്വാൻസ് കോച്ച്"],
    answer: "പൊതുവായ കോച്ച്"
  },
  {
    question: "What is the meaning of the Hindi sentence 'मुझे भूख लग रही है'?",
    options: ["I am feeling sleepy", "I am tired", "I am hungry", "I am fine"],
    answer: "I am hungry"
  },
  {
    question: "What is the Malayalam meaning of 'सफर'?",
    options: ["യാത്ര", "യാത്രക്കാരൻ", "ട്രെയിൻ", "പാസഞ്ചർ"],
    answer: "യാത്ര"
  },
  {
    question: "What is the meaning of 'व्यस्त'?",
    options: ["മനസ്സിലായിട്ടില്ല", "തിരക്കിലുള്ള", "നിർഭാഗ്യവശാൽ", "കൂട്ടിരിപ്പുള്ള"],
    answer: "തിരക്കിലുള്ള"
  },
  {
    question: "What is the correct Hindi translation of 'Please speak slowly'?",
    options: ["धीरे बोलो", "तेज़ बोलो", "कृपया धीरे बोलें", "जल्दी बोलिए"],
    answer: "कृपया धीरे बोलें"
  },
  {
    question: "What does 'खरीदी' mean in Malayalam?",
    options: ["കയറുക", "വാങ്ങിയത്", "വിറ്റത്", "കാണിച്ചത്"],
    answer: "വാങ്ങിയത്"
  },
  {
    question: "How do you say 'Can you help me?' in Hindi?",
    options: ["क्या आप मेरी मदद कर सकते हैं?", "क्या आप पानी पिएंगे?", "क्या आप मेरी कार चला सकते हैं?", "क्या आप मेरे दोस्त हैं?"],
    answer: "क्या आप मेरी मदद कर सकते हैं?"
  },
  {
    question: "What is the meaning of 'ज़ोरदार मोलभाव'?",
    options: ["തകർച്ച", "ശക്തമായ വാഗ്ദാനം", "വലിയ വില", "ശാന്തമായ ആവശ്യങ്ങൾ"],
    answer: "ശक्तമായ വാഗ്ദാനം"
  },
  {
    question: "What does 'काली आँखें' mean?",
    options: ["പച്ച കണ്ണുകൾ", "കറുത്ത കണ്ണുകൾ", "നീല കണ്ണുകൾ", "വലിയ കണ്ണുകൾ"],
    answer: "കറുത്ത കണ്ണുകൾ"
  },
  {
    question: "What is the Malayalam meaning of 'आँसू'?",
    options: ["കാത്", "കണ്ണുനീര്‍", "കണ്ണ്", "വായ്"],
    answer: "കണ്ണുനീര്‍"
  },
  {
    question: "What is the meaning of 'मुझे समझ नहीं आ रहा है।'?",
    options: ["I don't know", "I don’t understand", "I am going", "I can’t walk"],
    answer: "I don’t understand"
  },
  {
    question: "What is the Malayalam meaning of 'लेखक की याद'?",
    options: ["എഴുത്തുകാരന്റെ ഓർമ്മ", "എഴുത്തുകാരന്റെ സഹായം", "എഴുത്തുകാരന്റെ കാർ", "എഴുത്തുകാരന്റെ ലേഖനം"],
    answer: "എഴുത്തുകാരന്റെ ഓർമ്മ"
  }
],
            ml: [
                { question: "2+2 എത്ര?", options: ["3", "4", "5", "6"], answer: "4" },
                { question: "ഇന്ത്യയുടെ തലസ്ഥാനം?", options: ["മുംബൈ", "ഡെൽഹി", "കൊൽക്കത്ത", "ചെന്നൈ"], answer: "ഡെൽഹി" }
            ]
        };

        function setLanguage(lang) {
            language = lang;
            document.getElementById("language-selection").classList.add("hidden");
            document.getElementById("user-selection").classList.remove("hidden");
            fetchUsers();
        }

        async function fetchUsers() {
            let response = await fetch(USERS_URL, {
                headers: { Authorization: `Token ${API_KEY}` }
            });
            let data = await response.json();
            let select = document.getElementById("usernameSelect");
            select.innerHTML = "";
            data.results.forEach(user => {
                if (user.field_3448063) {
                    let option = document.createElement("option");
                    option.value = user.id;
                    option.textContent = user.field_3449365;
                    select.appendChild(option);
                }
            });
        }

        async function startQuiz() {
            let select = document.getElementById("usernameSelect");
            userId = select.value;
            let response = await fetch(USERS_URL, {
                headers: { Authorization: `Token ${API_KEY}` }
            });
            let data = await response.json();
            let user = data.results.find(u => u.id == userId);
            userRealName = user.field_3448072;
            permit = user.field_3461737;

            if (permit !== "P") {
                alert("You are not permitted to take the quiz.");
                return;
            }

            document.getElementById("playerName").innerText = `Welcome, ${userRealName}`;
            document.getElementById("user-selection").classList.add("hidden");
            document.getElementById("quiz-container").classList.remove("hidden");

            totalTime = questions[language].length * 60;
            document.getElementById("timeLeft").innerText = totalTime;
            timer = setInterval(updateTimer, 1000);

            loadQuestion();
            window.addEventListener("beforeunload", warnBeforeExit);
            document.addEventListener("visibilitychange", detectCheating);
            window.addEventListener("keydown", detectScreenshot);
        }

        function loadQuestion() {
            const qContainer = document.getElementById("question-container");
            qContainer.innerHTML = "";
            const q = questions[language][currentQuestionIndex];
            let questionHtml = `<p><strong>${q.question}</strong></p>`;
            q.options.forEach(option => {
                const selectedClass = userAnswers[currentQuestionIndex] === option ? 'selected' : '';
                questionHtml += `<div class="option ${selectedClass}" onclick="selectAnswer('${option}')">${option}</div>`;
            });
            qContainer.innerHTML = questionHtml;
            document.getElementById("prevBtn").style.display = currentQuestionIndex > 0 ? "inline-block" : "none";
            document.getElementById("nextBtn").style.display = currentQuestionIndex < questions[language].length - 1 ? "inline-block" : "none";
            document.getElementById("submitBtn").classList.toggle("hidden", currentQuestionIndex < questions[language].length - 1);
        }

        function selectAnswer(option) {
            userAnswers[currentQuestionIndex] = option;
            loadQuestion();
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions[language].length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function updateTimer() {
            totalTime--;
            document.getElementById("timeLeft").innerText = totalTime;
            if (totalTime <= 0) submitQuiz();
        }

        async function submitQuiz() {
            clearInterval(timer);
            calculateScore();
            if (!scoreUploaded && permit === "P") {
                await uploadScore();
                await updatePermit();
            }
            alert(`Quiz Over! Your Score: ${score}`);
            window.location.href = "leaderBoard.html";
        }

        function calculateScore() {
            score = questions[language].reduce((acc, q, i) =>
                acc + (userAnswers[i] === q.answer ? 10 : 0), 0);
        }

        async function uploadScore() {
            await fetch(SCORES_URL, {
                method: "POST",
                headers: {
                    Authorization: `Token ${API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    field_3452640: userRealName,
                    field_3452641: score.toString()
                })
            });
            scoreUploaded = true;
        }

        async function updatePermit() {
            await fetch(`${USERS_URL}${userId}/`, {
                method: "PATCH",
                headers: {
                    Authorization: `Token ${API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ field_3461737: "N" })
            });
        }

        function warnBeforeExit(event) {
            event.returnValue = "Your quiz will be submitted!";
            if (!scoreUploaded) submitQuiz();
        }

        function detectCheating() {
            if (document.hidden && !scoreUploaded) submitQuiz();
        }

        function detectScreenshot(e) {
            if (e.key === "PrintScreen" && !scoreUploaded) submitQuiz();
        }
    </script>
</body>

</html>